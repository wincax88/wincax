(this.webpackJsonpexpDate=this.webpackJsonpexpDate||[]).push([[0],{182:function(e,t,a){},283:function(e){e.exports=JSON.parse('{"a":"0.1.0"}')},284:function(e){e.exports=JSON.parse('{"a":"https://node-js-getting-started-demo.herokuapp.com"}')},289:function(e,t,a){e.exports=a(597)},304:function(e,t,a){},305:function(e,t,a){},308:function(e,t,a){},387:function(e,t){},389:function(e,t){},399:function(e,t){},401:function(e,t){},426:function(e,t){},428:function(e,t){},429:function(e,t){},435:function(e,t){},437:function(e,t){},455:function(e,t){},457:function(e,t){},469:function(e,t){},472:function(e,t){},477:function(e,t){},479:function(e,t){},502:function(e,t){},592:function(e,t,a){},593:function(e,t,a){},597:function(e,t,a){"use strict";a.r(t);a(290);var n=a(62),r=a(0),o=a.n(r),i=a(25),c=a.n(i),s=a(19),u=a(286),l=a.n(u),p=(a(300),a(277)),m=a(8),h=a(278),d=a(166),g=a(279),f=a.n(g),b=a(11),O={userId:"",userName:"",isMaster:!1,appRole:"",isLogon:!1,imageUrl:"https://iknow-pic.cdn.bcebos.com/b219ebc4b74543a92875861b15178a82b80114fe",isShowStartPage:!1,isShowCamera:!1,isShowCropImage:!0,isShowRecognizeResult:!1,croppedImageUrl:"",blocks:[]},v=function(e){return{type:"app/SET_IMAGE_URL",payload:e}},w=function(){return{type:"app/SHOW_CROP_IMAGE"}},E=function(){return{type:"app/SHOW_RECOGNIZE_RESULT"}},C=function(){return{type:"app/SHOW_CAMERA"}},S=function(e){return{type:"app/SET_CROPPED_IMAGE_URL",payload:e}},j=function(e){return{type:"app/SET_BLOCKS",payload:e}},R=Object(m.c)({app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.payload;switch(t.type){case"app/SET_BLOCKS":return Object(b.a)(Object(b.a)({},e),{},{blocks:a});case"app/SET_CROPPED_IMAGE_URL":return Object(b.a)(Object(b.a)({},e),{},{croppedImageUrl:a});case"app/SHOW_CAMERA":return Object(b.a)(Object(b.a)({},e),{},{isShowCamera:!0,isShowStartPage:!1,isShowCropImage:!1,isShowRecognizeResult:!1});case"app/HIDE_CAMERA":return Object(b.a)(Object(b.a)({},e),{},{isShowCamera:!1});case"app/SHOW_RECOGNIZE_RESULT":return Object(b.a)(Object(b.a)({},e),{},{isShowRecognizeResult:!0,isShowCropImage:!1,isShowCamera:!1,isShowStartPage:!1});case"app/HIDE_RECOGNIZE_RESULT":return Object(b.a)(Object(b.a)({},e),{},{isShowRecognizeResult:!1});case"app/SHOW_CROP_IMAGE":return Object(b.a)(Object(b.a)({},e),{},{isShowCropImage:!0,isShowCamera:!1,isShowRecognizeResult:!1,isShowStartPage:!1});case"app/HIDE_CROP_IMAGE":return Object(b.a)(Object(b.a)({},e),{},{isShowCropImage:!1});case"app/SET_IMAGE_URL":return Object(b.a)(Object(b.a)({},e),{},{imageUrl:a});case"app/SET_APP_USER":var n=a.appRole,r=a.userId,o=a.userName;return Object(b.a)(Object(b.a)({},e),{},{isMaster:"teacher"===n,appRole:n,userId:r,userName:o,isLogon:!(!r||r.length<=0)});default:return e}}}),y={key:"exp-date-root",storage:f.a,whitelist:["courseware","tabs"]},I=Object(d.a)(y,(function(e,t){return R(e,t)})),k=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||m.d,_=Object(m.e)(I,k(Object(m.a)(h.a)));console.info("Store created:",_.getState());var N=Object(d.b)(_),U=a(26),P=a(27),z=a(20),L=a(31),M=a(30),T=a(109),D=a.n(T),x=(a(303),a(304),function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;Object(U.a)(this,a),n=t.call(this,e);var r=document.getElementById("root");return n.state={width:r.clientWidth,height:r.clientHeight},n.handleTakePhoto=n.handleTakePhoto.bind(Object(z.a)(n)),n.handleResize=n.handleResize.bind(Object(z.a)(n)),n}return Object(P.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),this.handleResize()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"handleResize",value:function(){var e=document.getElementById("camera-container");e&&this.setState({width:e.clientWidth,height:e.clientHeight})}},{key:"handleTakePhoto",value:function(e){var t=this.props,a=t.setImageUrl,n=t.showCropImage;a(e),n()}},{key:"render",value:function(){var e=this;return this.props.isShowCamera?o.a.createElement("div",{className:"camera-container",id:"camera-container"},o.a.createElement(D.a,{isFullscreen:!0,isImageMirror:!1,idealFacingMode:T.FACING_MODES.ENVIRONMENT,imageType:T.IMAGE_TYPES.JPG,isMaxResolution:!0,isDisplayStartCameraError:!0,sizeFactor:1,onTakePhoto:function(t){e.handleTakePhoto(t)},onCameraError:function(e){console.error(e)}})):null}}]),a}(r.Component));var A=Object(s.b)((function(e){return{isShowCamera:e.app.isShowCamera}}),(function(e){return Object(m.b)({setImageUrl:v,showCropImage:w},e)}))(x),G=(a(305),function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(){return Object(U.a)(this,a),t.apply(this,arguments)}return Object(P.a)(a,[{key:"render",value:function(){return this.props.isShowCamera?o.a.createElement("div",{className:"grid-container"},o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"}),o.a.createElement("div",{className:"grid"})):null}}]),a}(r.Component));var H=Object(s.b)((function(e){return{isShowCamera:e.app.isShowCamera}}),(function(e){return Object(m.b)({},e)}))(G),W=(a(168),a(90)),B=a(280),F=a.n(B),J=(a(307),a(308),function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;return Object(U.a)(this,a),(n=t.call(this,e)).onImageLoaded=function(e){n.imageRef=e},n.onCropChange=function(e){n.setState({crop:e})},n.onCropComplete=function(e){n.imageRef&&e.width&&e.height&&n.getCroppedImg(n.imageRef,e,"newFile.jpeg").then((function(e){n.setState({croppedImageUrl:e}),console.log("croppedImageUrl",e)}))},n.state={crop:{unit:"%",x:10,y:30,width:80,height:30},croppedImageUrl:null},n.imageRef=null,n.onCropChange=n.onCropChange.bind(Object(z.a)(n)),n.onCropComplete=n.onCropComplete.bind(Object(z.a)(n)),n.getCroppedImg=n.getCroppedImg.bind(Object(z.a)(n)),n.onCamera=n.onCamera.bind(Object(z.a)(n)),n.onRecognize=n.onRecognize.bind(Object(z.a)(n)),n.onImageLoaded=n.onImageLoaded.bind(Object(z.a)(n)),n}return Object(P.a)(a,[{key:"componentDidMount",value:function(){}},{key:"getCroppedImg",value:function(e,t,a){var n=this,r=document.createElement("canvas"),o=e.naturalWidth/e.width,i=e.naturalHeight/e.height;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(e,t.x*o,t.y*i,t.width*o,t.height*i,0,0,t.width,t.height),new Promise((function(e){r.toBlob((function(t){t.name=a,window.URL.revokeObjectURL(n.fileUrl),n.fileUrl=window.URL.createObjectURL(t),e(n.fileUrl)}),"image/jpeg")}))}},{key:"onCamera",value:function(){(0,this.props.showCamera)()}},{key:"onRecognize",value:function(){var e=this.props,t=e.setCroppedImageUrl,a=e.showRecognizeResult;t(this.state.croppedImageUrl),a()}},{key:"render",value:function(){var e=this,t=this.props,a=t.isShowCropImage,n=t.imageUrl;return a?o.a.createElement("div",{className:"crop-image-container"},o.a.createElement(F.a,{src:n,crop:this.state.crop,keepSelection:!0,minWidth:20,minHeight:20,crossorigin:"anonymous",onImageLoaded:this.onImageLoaded,onChange:function(t){return e.onCropChange(t)},onComplete:this.onCropComplete}),o.a.createElement("div",{className:"button-wrap"},o.a.createElement(W.a,{shape:"circle",icon:"camera",className:"camera-button",onClick:this.onCamera}),o.a.createElement(W.a,{type:"primary",shape:"circle",icon:"check",className:"process-button",onClick:this.onRecognize}))):null}}]),a}(r.Component));var q=Object(s.b)((function(e){return{isShowCropImage:e.app.isShowCropImage,imageUrl:e.app.imageUrl}}),(function(e){return Object(m.b)({showCamera:C,setCroppedImageUrl:S,showRecognizeResult:E},e)}))(J),Z=(a(353),a(287)),K=(a(182),function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;return Object(U.a)(this,a),(n=t.call(this,e)).state={},n}return Object(P.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.top,a=e.left,n=e.height,r=e.width,i=e.score,c=parseInt(255*i),s={top:t+10+"px",left:a+10+"px",height:n+"px",width:r+"px",background:"rgba(".concat(c,", 0, 0, 0.33)")};return o.a.createElement("div",{className:"text-rect-container",style:s})}}]),a}(r.Component));var V,X=Object(s.b)((function(e){return{}}),(function(e){return Object(m.b)({},e)}))(K),Y=a(44),Q=a.n(Y),$=a(61),ee=a.n($),te=a(45),ae=a.n(te),ne=a(283),re=(a(373),a(61));function oe(e,t,a){return new Promise((function(n,r){Q.a.post(e,re.stringify(t),a).then((function(t){var a=t.data;return 200===a.status||"200"===a.status||200===a.state||"200"===a.state||1===a.status||"1"===a.status||1===a.success||200===a.code||200===t.status?n(a):(console.error("post : ",e,t),r(a.msg||a.message||"\u672a\u77e5\u9519\u8bef"))}),(function(t){if(console.error("post : ",e,t),t)return r(t.msg||t.message||"\u672a\u77e5\u9519\u8bef")}))}))}ae.a.app_key=V,ae.a.url="https://asia-try.count.ly",ae.a.app_version=ne.a,ae.a.debug=!1,ae.a.init(),ae.a.q.push(["track_sessions"]),ae.a.q.push(["track_errors"]),Q.a.defaults.timeout=3e4,Q.a.defaults.headers.common.retry=3,Q.a.defaults.headers.common.retryDelay=1e3,Q.a.interceptors.response.use((function(e){return e&&e.data&&(0===e.data.status||-1===e.data.state)&&e.data.msg&&e.data.msg.includes("\u672a\u767b")?(alert("\u8fd8\u672a\u767b\u5f55!"),window.location.href="/user",Promise.reject("\u8fd8\u672a\u767b\u5f55!")):e}),(function(e){var t,a,n=e.config,r=n.headers;return n&&r.retry?(r.__retryCount=r.__retryCount||0,r.__retryCount>=r.retry?(e.message.includes("timeout")||e.message.includes("Network Error"),t="http_error",a=e.message,ae.a.q.push(["add_event",{key:t,segmentation:{value:ee.a.stringify(a)}}]),Promise.reject(e)):(r.__retryCount+=1,new Promise((function(e){setTimeout(e,r.retryDelay||1)})).then((function(){return Q()(n)})))):Promise.reject(e)}));window.location.href.indexOf("localhost"),Q.a;var ie=a(284),ce=function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;return Object(U.a)(this,a),(n=t.call(this,e)).state={},n}return Object(P.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e){this.props.isShowRecognizeResult&&!e.isShowRecognizeResult&&this.doRecognize()}},{key:"doRecognize",value:function(){var e=this.props,t=e.croppedImageUrl,a=e.setBlocks;fetch(t).then((function(e){return e.blob()})).then((function(e){var t=new FileReader;t.readAsDataURL(e),t.onloadend=function(){(function(e){var t=parseInt((new Date).getTime()/1e3);return oe("".concat(ie.a,"/recognize"),{timestamp:t,image:e})})(t.result.replace("data:image/jpeg;base64,","")).then((function(e){e.data&&e.data.document&&e.data.document.blocks?(console.log(e.data.document.blocks),a(e.data.document.blocks)):a([])})).catch((function(e){console.error(e),Z.a.warn(JSON.stringify(e))}))}}))}},{key:"render",value:function(){var e=this.props,t=e.isShowRecognizeResult,a=e.croppedImageUrl,n=e.blocks,r=n.map((function(e,t){console.log(e.lines[0].characters);var a=e.lines[0].text;return o.a.createElement("div",{key:t},a)})),i=n.map((function(e,t){console.log(e.lines[0].position);var a=e.lines[0].score,n=e.lines[0].position.bounding_box;return o.a.createElement(X,{key:t,height:n.height,width:n.width,top:n.top,left:n.left,score:a})}));return t?o.a.createElement("div",{className:"recognize-container"},o.a.createElement("div",null,o.a.createElement("img",{src:a,alt:""}),o.a.createElement("div",{className:"text-rect-wrap"},i)),o.a.createElement("div",{className:"result-wrap"},r)):null}}]),a}(r.Component);var se=Object(s.b)((function(e){return{isShowRecognizeResult:e.app.isShowRecognizeResult,croppedImageUrl:e.app.croppedImageUrl,blocks:e.app.blocks}}),(function(e){return Object(m.b)({setBlocks:j},e)}))(ce),ue=(a(592),function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;return Object(U.a)(this,a),(n=t.call(this,e)).state={},n.onStart=n.onStart.bind(Object(z.a)(n)),n}return Object(P.a)(a,[{key:"componentDidMount",value:function(){}},{key:"onStart",value:function(){(0,this.props.showCamera)()}},{key:"render",value:function(){return this.props.isShowStartPage?o.a.createElement("div",{className:"start-pahge-container"},o.a.createElement(W.a,{type:"primary",shape:"circle",icon:"scan",className:"start-button",onClick:this.onStart})):null}}]),a}(r.Component));var le=Object(s.b)((function(e){return{isShowStartPage:e.app.isShowStartPage}}),(function(e){return Object(m.b)({showCamera:C},e)}))(ue);a(593);var pe=function(){return o.a.createElement("div",{className:"app-container"},o.a.createElement(le,null),o.a.createElement(A,null),o.a.createElement(H,null),o.a.createElement(q,null),o.a.createElement(se,null))},me=o.a.createElement(n.a,{locale:l.a},o.a.createElement(s.a,{store:_},o.a.createElement(p.a,{loading:null,persistor:N},o.a.createElement(pe,null))));c.a.render(me,document.getElementById("root"))}},[[289,1,2]]]);
//# sourceMappingURL=main.55ad3ed8.chunk.js.map